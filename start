export HTTP_PORT=8080
export HTTPS_PORT=8000
export HTTPS_ENABLED=false #Don't forget to turn off HTTPS url redirect in NameCheap
export BUILD_ENVIRONMENT=production
export HOST_PROVIDER=digitalocean #either digitalocean or amazon

# port remapping solution involving changing the routing table
sudo iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to $HTTP_PORT

if [ $HTTPS_ENABLED == 'true' ]; then
  sudo iptables -t nat -A PREROUTING -p tcp --dport 443 -j REDIRECT --to $HTTPS_PORT
fi

# Allocate 4GB Swap Space
sudo /bin/dd if=/dev/zero of=/var/swap.1 bs=1M count=4096
sudo /sbin/mkswap /var/swap.1
sudo /sbin/swapon /var/swap.1

sudo mkdir -p /data/db
sudo mkdir -p /log
sudo touch /log/mongod.log

# old change permissions command:
# sudo chown $(whoami) /data/db # $() forks the script, runs the contents, and returns the output
sudo chown `id -u` /data/db # $() forks the script, runs the contents, and returns the output
sudo cp mongod.conf /etc/mongod.conf
sudo mongod --config /etc/mongod.conf

./node_modules/forever/bin/forever \
start \
-al forever.log \
-ao out.log \
-ae err.log \
app.js

